import { BrandingWatermark } from "@mui/icons-material";
import Head from "next/head";
import Image from "next/image";
import Banner1 from "../assets/Banner1.jpg";
import webdevelopment from "../assets/webdevelopment.png";
import InfiniteScroll from "react-infinite-scroll-component";
import { stringify } from "postcss";
import mongoose from "mongoose";
import Blogs from "../models/Blogs"

const Home = ({JsBlog,PyBlog})=> {
  console.log(JsBlog,PyBlog)

  return (
    <div className="">
      <Head>
        <title>CodesBlog</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="m-auto">
        <section className="text-gray-600 body-font m-auto">
          <div className="container px-5 py-6 mx-auto w-auto">
            <div className="text-center mb-20">
              <h1 className="sm:text-3xl text-2xl font-medium title-font text-gray-900 mb-4">
                &lt;CodesBlog/&gt;
              </h1>
              <p>One place to find the every code</p>
              <div className="flex mt-4 justify-center">
                <div className="w-16 h-1 rounded-full bg-violet-500 inline-flex"></div>
              </div>
            </div>
            {/* Blog Content */}
            <div id="blog" className="px-4 xl:px-0 py-0">
              <div className="mx-auto container">
                <div className="mt-12 lg:mt-24">
                  <div className="grid sm:grid-cols-1 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-8">
                    {Object.keys(JsBlog).map((item)=>
                    {
                      return(
                      <div>
                      <Image
                        className="w-full rounded-t-2xl"
                        src={Banner1}
                        alt="JavaScript"
                      />
                      <div className="py-4 px-8 w-full flex justify-between bg-violet-700">
                        <p className="text-sm text-white font-semibold tracking-wide">
                          {JsBlog[item].category}
                        </p>
                        <p className="text-sm text-white font-semibold tracking-wide">
                        {JsBlog[item].createdAt}
                        
                        </p>
                      </div>
                      <div className="bg-white px-10 py-6 rounded-bl-3xl rounded-br-3xl">
                        <h1 className="text-4xl text-gray-900 font-semibold tracking-wider">
                          {JsBlog[item].title}
                        </h1>
                        <p className="text-gray-700 text-sm lg:text-sm  lg:leading-8 tracking-wide mt-6 w-11/12">
                          {JsBlog[item].desc}
                        </p>
                        <div className="w-full mt-4 justify-end flex items-center cursor-pointer">
                          <p className="text-base tracking-wide text-indigo-500">
                            Read more
                          </p>
                          <svg
                            className="ml-3 lg:ml-6"
                            xmlns="http://www.w3.org/2000/svg"
                            width={20}
                            height={18}
                            viewBox="0 0 20 18"
                            fill="none"
                          >
                            <path
                              d="M11.7998 1L18.9998 8.53662L11.7998 16.0732"
                              stroke="#4338ca"
                              strokeWidth={2}
                              strokeLinecap="round"
                              strokeLinejoin="round"
                            />
                            <path
                              d="M1 8.53662H19"
                              stroke="#4338ca"
                              strokeWidth={2}
                              strokeLinecap="round"
                              strokeLinejoin="round"
                            />
                          </svg>
                        </div>
                        <div className="h-5 w-2" />
                      </div>
                    </div>
                    )})}
                    <div>
                    {/* card 1st row */}
                    <div className="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-8">
                    {Object.keys(PyBlog).map((item)=>{
                    return ( <div>
                          <Image
                            className="w-full rounded-t-2xl"
                            src={webdevelopment}
                            alt="games"
                          />
                          <div className="py-2 px-4 w-full flex justify-between bg-indigo-700">
                            <p className="text-sm text-white font-semibold tracking-wide">
                              {PyBlog[item].title}
                            </p>
                            <p className="text-sm text-white font-semibold tracking-wide">
                              {PyBlog[item].createdAt}
                            </p>
                          </div>
                          <div className="bg-white px-3  lg:px-6 py-4 rounded-bl-3xl rounded-br-3xl">
                            <h1 className="text-lg text-gray-900 font-semibold tracking-wider">
                              {PyBlog[item].title}
                            </h1>
                            <p className="text-gray-700 text-sm  lg:text-sm  lg:leading-8 pr-4 tracking-wide mt-2">
                              {PyBlog[item].desc}
                            </p>
                          </div>
                        </div>
                      )})}
                      </div> 
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button className="flex mx-auto mt-16 text-white bg-indigo-500 border-0 py-2 px-8 focus:outline-none hover:bg-indigo-600 rounded text-lg">
              View More
            </button>
          </div>
        </section>

        <section className="text-gray-600 body-font overflow-hidden ">
          <div className="flex container px-5 py-24 mx-auto w-1/2">
            <div className="-my-8 divide-y-2 divide-gray-100">
              <div className="py-8 flex flex-wrap md:flex-nowrap">
                <div className="md:w-64 md:mb-0 mb-6 flex-shrink-0 flex flex-col">
                  <span className="font-semibold title-font text-gray-700">
                    CATEGORY
                  </span>
                  <span className="mt-1 text-gray-500 text-sm">
                    12 Jun 2019
                  </span>
                </div>
                <div className="md:flex-grow">
                  <h2 className="text-2xl font-medium text-gray-900 title-font mb-2">
                    Bitters hashtag waistcoat fashion axe chia unicorn
                  </h2>
                  <p className="leading-relaxed">
                    Glossier echo park pug, church-key sartorial biodiesel
                    vexillologist pop-up snackwave ramps cornhole. Marfa 3 wolf
                    moon party messenger bag selfies, poke vaporware kombucha
                    lumbersexual pork belly polaroid hoodie portland craft beer.
                  </p>
                  <a className="text-indigo-500 inline-flex items-center mt-4">
                    Learn More
                    <svg
                      className="w-4 h-4 ml-2"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      strokeWidth="2"
                      fill="none"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                    >
                      <path d="M5 12h14"></path>
                      <path d="M12 5l7 7-7 7"></path>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  );
}


// Fetching the blogs from server

export async function getServerSideProps(context){
  if (!mongoose.connections[0].readyState) {
    await mongoose.connect(process.env.MONGO_URI);
  }
   await Blogs.find();
  const [JsBlogRes, PyBlogRes] = await Promise.all([
    fetch(`${process.env.NEXT_PUBLIC_HOST}/api/getjsblog`), 
    fetch(`${process.env.NEXT_PUBLIC_HOST}/api/getblogs`)
  ]);
  const [JsBlog, PyBlog] = await Promise.all([
    JsBlogRes.json(), 
    PyBlogRes.json()
  ]);
  return {
    props: {
      JsBlog ,
      PyBlog 
    }, // will be passed to the page component as props
  };
  // JsBlog: JSON.parse(JSON.stringify(JsBlog)),
}

export default Home;

